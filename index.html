<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TopsOffer Thailand ‚Äî Pop Secret Popcorn (Debug + CSP tips)</title>
  <!-- ‡πÉ‡∏ä‡πâ EmailJS ‡∏£‡∏∏‡πà‡∏ô @emailjs/browser -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  <!-- QRCode -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <style>
    :root{
      --brand:#232f3e; --accent:#ffa41c; --accent2:#ffd814; --price:#b12704;
      --bg:#f3f3f3; --card:#fff; --text:#111; --muted:#666; --border:#e3e6e6;
      --star:#f59e0b; --instock:#067d62; --lowstock:#b12704; --viewer:#007185;
      --shipbg:#0a6a58; --shipfg:#ffffff;
    }
    *{box-sizing:border-box}
    body{font-family:Arial,Helvetica,sans-serif;background:var(--bg);color:var(--text);margin:0}
    header{background:var(--brand);color:#fff;padding:12px 16px;display:flex;align-items:center;gap:12px;position:sticky;top:0;z-index:20;justify-content:space-between}
    .logo{font-weight:bold;font-size:18px;white-space:nowrap}
    .cart{white-space:nowrap;font-size:16px}
    .lang-switch{display:flex;gap:6px}
    .lang-switch button{background:#fff;color:#232f3e;border:1px solid #d5d9d9;border-radius:6px;padding:6px 8px;font-weight:bold;cursor:pointer}
    .lang-switch button.active{background:#ffd814;border-color:#fcd200}

    .banner{background:#fff3cd;color:#664d03;border:1px solid #ffecb5;padding:10px 12px}
    .debug{background:#1e1e1e;color:#fff;padding:10px 12px;white-space:pre-wrap;font-size:12px}
    .debug b{color:#ffd814}
    .hide{display:none}

    .shipbar{
      background:var(--shipbg); color:var(--shipfg);
      text-align:center; padding:10px 12px; font-weight:bold;
      position:sticky; top:48px; z-index:19;
      box-shadow:0 0 0 3px rgba(14,124,102,.25) inset;
    }
    .shipbar small{font-weight:normal; opacity:.9}

    .container{max-width:1200px;margin:18px auto;padding:0 12px;display:grid;grid-template-columns: 1.15fr 1fr;gap:18px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:8px;padding:18px;box-shadow:0 1px 2px rgba(0,0,0,.06)}
    .gallery-main{text-align:center}
    .gallery-main img{max-width:100%;border-radius:8px;border:1px solid #ddd}
    .thumbs{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap;justify-content:center}
    .thumbs img{width:80px;height:80px;object-fit:cover;border:2px solid transparent;border-radius:6px;cursor:pointer}
    .thumbs img.active{border-color:#007185}

    .details h1{margin:.2em 0 .4em}
    .subtle{color:var(--muted);font-size:14px}
    .rating{display:flex;align-items:center;gap:8px;margin:.4em 0}
    .stars{color:var(--star)}
    .price{color:var(--price);font-size:22px;margin:.4em 0 .3em}
    .meta-row{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
    .badge{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;font-size:12px;font-weight:bold}
    .badge.in{background:#e8f5f1;color:var(--instock);border:1px solid #c7eee4}
    .badge.low{background:#fdecea;color:var(--lowstock);border:1px solid #facdca}
    .viewer{font-size:13px;color:var(--viewer)}

    .bullets{margin:.5em 0 1em;padding-left:18px}
    .desc{margin-top:12px;background:#fafbfd;border:1px solid var(--border);border-radius:10px;padding:14px 16px}
    .features{margin-top:10px;display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
    .feat{display:flex;gap:10px;align-items:flex-start;background:#fff;border:1px solid var(--border);border-radius:10px;padding:10px 12px}
    .feat .ico{font-size:20px;line-height:1.2}
    .feat b{display:block}

    .buybox .row{display:flex;align-items:center;gap:10px;margin:8px 0}
    .qty input{width:56px;text-align:center;padding:6px;border:1px solid #ccc;border-radius:4px}
    .btn{border:none;border-radius:20px;padding:12px 16px;font-weight:bold;cursor:pointer;width:100%}
    .btn-cart{background:var(--accent)}
    .btn-buynow{background:var(--accent2);margin-top:8px}
    .form label{display:block;margin-top:10px;font-size:14px}
    .form input,.form textarea{width:100%;padding:10px;border:1px solid #ccc;border-radius:6px;margin-top:6px;font-size:15px}
    .qrcode{text-align:center;margin-top:14px}
    .note{font-size:12px;color:#555;margin-top:8px}
    .ok{color:#067d62;text-align:center;margin-top:10px}
    .err{color:#b12704;text-align:center;margin-top:10px}

    .kpis{display:flex;gap:16px;flex-wrap:wrap;margin-top:8px}
    .kpi{background:#f7f7f7;border:1px solid var(--border);border-radius:8px;padding:8px 12px;font-size:13px}

    .summary{margin-top:12px;border-top:1px dashed var(--border);padding-top:12px}
    .sum-row{display:flex;justify-content:space-between;margin:4px 0;font-size:14px}
    .sum-total{font-weight:bold;font-size:16px;margin-top:6px}
    .free{color:#067d62;font-weight:bold}

    .share-row{display:flex;gap:10px;margin-top:10px}
    .share-btn{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--border);background:#fff;border-radius:999px;padding:8px 12px;font-size:13px;cursor:pointer}

    footer{padding:12px;text-align:center;font-size:.9rem;color:#666;background:#f8f8f8}

    @media (max-width: 980px){
      .container{grid-template-columns:1fr}
      .shipbar{top:48px}
      .features{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <header>
    <div class="logo" id="t_brand">TopsOffer Thailand</div>
    <div style="display:flex;gap:12px;align-items:center">
      <div class="cart" id="t_cart">üõí</div>
      <div class="lang-switch"><button id="langTH" type="button">TH</button><button id="langEN" type="button">EN</button></div>
    </div>
  </header>

  <!-- Debug banners -->
  <div id="bannerFile" class="banner hide">‚ö†Ô∏è ‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏à‡∏≤‡∏Å <b>file://</b> ‚Äî ‡∏ö‡∏≤‡∏á‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏õ‡∏¥‡∏î‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏ß‡πá‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå (‡πÄ‡∏ä‡πà‡∏ô <code>python -m http.server 8000</code>)</div>
  <div id="bannerCSP" class="banner hide">‚ö†Ô∏è ‡∏≠‡∏≤‡∏à‡∏°‡∏µ <b>Content-Security-Policy (CSP)</b> ‡∏ö‡∏ô‡πÇ‡∏Æ‡∏™‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏ö‡∏•‡πá‡∏≠‡∏Ñ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡πÅ‡∏ö‡∏ö inline ‚Äî ‡∏î‡∏π‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡∏ó‡πâ‡∏≤‡∏¢‡∏´‡∏ô‡πâ‡∏≤</div>
  <div id="debug" class="debug hide"></div>

  <div class="shipbar">
    üöö <span id="t_freeship">‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ‡∏ó‡∏∏‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</span> <small id="t_freeship_sub">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥</small>
  </div>

  <main class="container">
    <section class="card">
      <div class="gallery-main">
        <img id="mainImg" src="https://i.ibb.co/9kvfpgzg/166578-0.jpg" alt="Pop Secret Popcorn"/>
      </div>
      <div class="thumbs" id="thumbs">
        <img class="active" src="https://i.ibb.co/9kvfpgzg/166578-0.jpg" alt="main">
        <img src="https://i.ibb.co/t57D3Tv/166579-0.jpg" alt="side1">
        <img src="https://i.ibb.co/Zz8BXHZ0/166580-0.jpg" alt="side2">
        <img src="https://i.ibb.co/SwB3Y16W/166581-0.jpg" alt="back">
      </div>

      <div class="details">
        <h1 id="t_name">Pop Secret Popcorn Movie Theater Butter 588g</h1>
        <div class="subtle" id="t_sku">Ships from Thailand | Sold by TopsOffer Thailand</div>
        <div class="rating"><div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div><div id="t_reviews_count">5 reviews</div></div>
        <div class="price"><span id="t_price">Price</span>: <b><span id="price">1299</span> THB</b></div>
        <div class="meta-row">
          <span id="stockBadge" class="badge in">‚úî In stock</span>
          <span id="viewerNow" class="viewer">23 people are viewing this now</span>
        </div>
        <div class="kpis">
          <div class="kpi" id="kpi_sales">Sales today: <b><span id="salesToday">0</span></b></div>
          <div class="kpi">Promo ends in: <b><span id="countdown">--:--:--</span></b></div>
        </div>
        <ul class="bullets" id="t_bullets">
          <li>Movie-theater butter aroma</li>
          <li>Large 588g pack</li>
          <li>Microwave in 2‚Äì3 minutes</li>
          <li>Perfect for movie nights & parties</li>
        </ul>

        <div class="desc">
          <h3 id="t_desc_title">Product Description</h3>
          <p id="t_desc_intro">üçø Pop Secret Popcorn Movie Theater Butter 588g ‚Äî rich buttery aroma just like at the cinema, ready in minutes.</p>

          <div class="features" id="features">
            <div class="feat"><div class="ico">üçø</div><div><b id="f1h">Premium Kernels</b><div id="f1t">Fluffy, crispy pops for a satisfying crunch.</div></div></div>
            <div class="feat"><div class="ico">üßà</div><div><b id="f2h">Movie Theater Butter</b><div id="f2t">Savory, buttery flavor that feels like the cinema.</div></div></div>
            <div class="feat"><div class="ico">‚è±Ô∏è</div><div><b id="f3h">Ready in 3‚Äì4 mins</b><div id="f3t">Just microwave‚Äîno oil, no pan, no mess.</div></div></div>
            <div class="feat"><div class="ico">üé¨</div><div><b id="f4h">Made for Movie Night</b><div id="f4t">Perfect for Netflix, parties, or a quick snack.</div></div></div>
          </div>

          <div class="share-row">
            <button class="share-btn" id="shareLine">Share on LINE</button>
            <button class="share-btn" id="shareFb">Share on Facebook</button>
          </div>
        </div>
      </div>
    </section>

    <aside class="card buybox">
      <div class="row qty">
        <label id="t_qty" for="quantity">Qty (max 3)</label>
        <input id="quantity" type="number" min="1" max="3" value="1"/>
      </div>
      <div class="row"><div><b id="t_total">Total:</b></div><div><b><span id="total">1299</span> THB</b></div></div>

      <div class="summary">
        <div class="sum-row"><span id="t_sum_items">Items</span> <span><span id="sumItems">1299</span> THB</span></div>
        <div class="sum-row"><span id="t_sum_ship">Shipping</span> <span class="free" id="sumShip">FREE</span></div>
        <div class="sum-row sum-total"><span id="t_sum_grand">Grand total</span> <span><span id="sumGrand">1299</span> THB</span></div>
      </div>

      <button class="btn btn-cart" id="btnAddCart">Add to Cart</button>
      <button class="btn btn-buynow" id="btnBuyNow">Buy Now</button>

      <form id="orderForm" class="form" style="margin-top:12px">
        <label for="fname" id="t_fullname">Full Name</label>
        <input id="fname" name="name" required placeholder="John Doe"/>
        <label for="phone" id="t_phone">Phone Number</label>
        <input id="phone" name="phone" required placeholder="08xxxxxxxx"/>
        <label for="addr" id="t_address">Shipping Address</label>
        <textarea id="addr" name="address" required placeholder="Address, District, Province, Postal code"></textarea>
        <button class="btn btn-cart" type="submit" id="t_pay">Pay with PromptPay</button>
        <div class="note" id="t_note">A PromptPay QR will be generated for your exact amount.</div>
      </form>
      <div id="qrcode" class="qrcode"></div>
      <div id="msg" class="ok" style="display:none;"></div>
      <div id="err" class="err" style="display:none;"></div>
    </aside>
  </main>

  <footer>¬© 2025 TopsOffer Thailand</footer>

  <script>
    // ===== Debug helpers =====
    const dbg = document.getElementById('debug');
    function showDebug(msg){
      dbg.classList.remove('hide');
      dbg.textContent += (typeof msg==='string'? msg : JSON.stringify(msg, null, 2)) + "\\n";
      console.log(msg);
    }
    if(location.protocol === 'file:'){ document.getElementById('bannerFile').classList.remove('hide'); }
    // ‡∏ñ‡πâ‡∏≤ script ‡∏ô‡∏µ‡πâ‡∏£‡∏±‡∏ô‡πÑ‡∏î‡πâ ‡πÅ‡∏õ‡∏•‡∏ß‡πà‡∏≤ inline script "‡∏¢‡∏±‡∏á‡∏£‡∏±‡∏ô‡πÑ‡∏î‡πâ" ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ

    // ===== Configs =====
    const EMAILJS_PUBLIC_KEY = 'UaGsOS23RWVTmDwAn';
    const EMAILJS_SERVICE_ID = 'service_topsoffer';
    const EMAILJS_TEMPLATE_ID = 'template_topsoffer';
    const EMAIL_TO = "officialvoucher@gmail.com";

    const UNIT_PRICE = 1299;
    const PRODUCT_NAME = "Pop Secret Popcorn Movie Theater Butter 588g";
    const PROMPTPAY_MOBILE = "0866292379";
    const PROMPTPAY_NATIONAL_ID = "5110100025854";
    const PROMPTPAY_USE = "mobile"; // 'mobile' or 'nid'

    const ENFORCE_STOCK = false;
    let INVENTORY = 9999;

    let VIEWERS = Math.floor(Math.random()*10) + 18;
    let SALES_TODAY = Math.floor(Math.random()*8) + 12;
    const promoEnd = (()=>{ const now = new Date(); return new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59); })();

    // ===== i18n =====
    const i18n = {
      th:{brand:"TopsOffer Thailand", cart:"‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤", name:"‡∏Ç‡πâ‡∏≤‡∏ß‡πÇ‡∏û‡∏î‡∏≠‡∏ö‡πÄ‡∏ô‡∏¢ Pop Secret 588g",
        sku:"‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏à‡∏≤‡∏Å‡πÑ‡∏ó‡∏¢ | ‡∏Ç‡∏≤‡∏¢‡πÇ‡∏î‡∏¢ TopsOffer Thailand", price:"‡∏£‡∏≤‡∏Ñ‡∏≤",
        bullets:["‡∏Å‡∏•‡∏¥‡πà‡∏ô‡πÄ‡∏ô‡∏¢‡∏´‡∏≠‡∏°‡πÅ‡∏ö‡∏ö‡πÇ‡∏£‡∏á‡∏´‡∏ô‡∏±‡∏á","‡πÅ‡∏û‡πá‡∏Ñ‡πÉ‡∏´‡∏ç‡πà 588g","‡∏≠‡∏∏‡πà‡∏ô‡πÑ‡∏°‡πÇ‡∏Ñ‡∏£‡πÄ‡∏ß‡∏ü 2‚Äì3 ‡∏ô‡∏≤‡∏ó‡∏µ","‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô‡∏î‡∏π‡∏´‡∏ô‡∏±‡∏á & ‡∏õ‡∏≤‡∏£‡πå‡∏ï‡∏µ‡πâ"],
        reviews_title:"‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏à‡∏≤‡∏Å‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤", count_reviews:"5 ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß", qty:"‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 3)", total:"‡∏£‡∏ß‡∏°",
        fullname:"‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•", phone:"‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£", address:"‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á", pay:"‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏ú‡πà‡∏≤‡∏ô PromptPay",
        note:"‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏¥‡∏ß‡∏≠‡∏≤‡∏£‡πå PromptPay ‡∏ï‡∏≤‡∏°‡∏¢‡∏≠‡∏î‡∏ä‡∏≥‡∏£‡∏∞‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì", ok:"‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!", err:"‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÑ‡∏î‡πâ ‡πÇ‡∏õ‡∏£‡∏î‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á.",
        addcart:"‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤", buynow:"‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏•‡∏¢",
        instock:"‚úî ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á", lowstock:"‚ö† ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ô‡πâ‡∏≠‡∏¢",
        viewing:(n)=> `${n} ‡∏Ñ‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏π‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ`, sales_today:"‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ", promo_ends:"‡πÇ‡∏õ‡∏£‡∏Ø ‡∏´‡∏°‡∏î‡πÉ‡∏ô",
        freeship:"‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ‡∏ó‡∏∏‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå", freeship_sub:"‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥",
        sum_items:"‡∏Ñ‡πà‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤", sum_ship:"‡∏Ñ‡πà‡∏≤‡∏à‡∏±‡∏î‡∏™‡πà‡∏á", sum_grand:"‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥", free:"‡∏ü‡∏£‡∏µ",
        desc_title:"‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤",
        desc_intro:"üçø Pop Secret Popcorn Movie Theater Butter 588g ‚Äî ‡∏õ‡πä‡∏≠‡∏õ‡∏Ñ‡∏≠‡∏£‡πå‡∏ô‡∏£‡∏™‡πÄ‡∏ô‡∏¢‡∏´‡∏≠‡∏° ‡∏°‡∏±‡∏ô ‡πÄ‡∏Ñ‡πá‡∏°‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏µ ‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÇ‡∏£‡∏á‡∏´‡∏ô‡∏±‡∏á‡πÅ‡∏ó‡πâ ‡πÜ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏™‡∏¥‡∏£‡πå‡∏ü‡πÉ‡∏ô‡πÑ‡∏°‡πà‡∏Å‡∏µ‡πà‡∏ô‡∏≤‡∏ó‡∏µ",
        f1h:"‡πÄ‡∏°‡∏•‡πá‡∏î‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏°", f1t:"‡πÅ‡∏ï‡∏Å‡∏ü‡∏π ‡∏Å‡∏£‡∏≠‡∏ö ‡∏´‡∏≠‡∏°‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏≥",
        f2h:"Movie Theater Butter", f2t:"‡∏Å‡∏•‡∏¥‡πà‡∏ô‡πÄ‡∏ô‡∏¢‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÇ‡∏£‡∏á‡∏´‡∏ô‡∏±‡∏á ‡πÄ‡∏Ç‡πâ‡∏°‡∏Ç‡πâ‡∏ô",
        f3h:"‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏¥‡∏ô‡πÉ‡∏ô 3‚Äì4 ‡∏ô‡∏≤‡∏ó‡∏µ", f3t:"‡πÅ‡∏Ñ‡πà‡∏≠‡∏∏‡πà‡∏ô‡πÑ‡∏°‡πÇ‡∏Ñ‡∏£‡πÄ‡∏ß‡∏ü‚Äî‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô",
        f4h:"‡πÄ‡∏Å‡∏¥‡∏î‡∏°‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏∑‡∏ô‡∏î‡∏π‡∏´‡∏ô‡∏±‡∏á", f4t:"‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏ã‡∏µ‡∏£‡∏µ‡∏™‡πå ‡∏õ‡∏≤‡∏£‡πå‡∏ï‡∏µ‡πâ ‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏£‡πá‡∏ß ‡πÜ"
      },
      en:{brand:"TopsOffer Thailand", cart:"üõí Cart", name:"Pop Secret Popcorn Movie Theater Butter 588g",
        sku:"Ships from Thailand | Sold by TopsOffer Thailand", price:"Price",
        bullets:["Movie-theater butter aroma","Large 588g pack","Microwave in 2‚Äì3 minutes","Perfect for movie nights & parties"],
        reviews_title:"Customer reviews", count_reviews:"5 reviews", qty:"Qty (max 3)", total:"Total",
        fullname:"Full Name", phone:"Phone Number", address:"Shipping Address", pay:"Pay with PromptPay",
        note:"A PromptPay QR will be generated for your exact amount.", ok:"Order sent successfully!", err:"Failed to send email. Please try again.",
        addcart:"Add to Cart", buynow:"Buy Now",
        instock:"‚úî In stock", lowstock:"‚ö† Low stock",
        viewing:(n)=> `${n} people are viewing this now`, sales_today:"Sales today", promo_ends:"Promo ends in",
        freeship:"Free shipping on every order", freeship_sub:"No minimum",
        sum_items:"Items", sum_ship:"Shipping", sum_grand:"Grand total", free:"FREE",
        desc_title:"Product Description",
        desc_intro:"üçø Pop Secret Popcorn Movie Theater Butter 588g ‚Äî rich, buttery movie-theater taste ready in minutes.",
        f1h:"Premium Kernels", f1t:"Fluffy, crispy pops for a satisfying crunch.",
        f2h:"Movie Theater Butter", f2t:"Savory, buttery flavor that feels like the cinema.",
        f3h:"Ready in 3‚Äì4 mins", f3t:"Just microwave‚Äîno oil, no pan, no mess.",
        f4h:"Made for Movie Night", f4t:"Perfect for Netflix, parties, or a quick snack."
      }
    };
    let lang = localStorage.getItem('lang') || ((navigator.language||'en').toLowerCase().startsWith('th') ? 'th' : 'en');
    let t = i18n[lang]; document.documentElement.lang = (lang==='th'?'th':'en');

    function setText(){
      const bl = document.getElementById('t_bullets'); bl.innerHTML=''; t.bullets.forEach(x=>{ const li=document.createElement('li'); li.textContent=x; bl.appendChild(li); });
      document.getElementById('t_brand').textContent = t.brand;
      document.getElementById('t_cart').textContent = t.cart;
      document.getElementById('t_name').textContent = t.name;
      document.getElementById('t_sku').textContent = t.sku;
      document.getElementById('t_price').textContent = t.price;
      document.getElementById('t_reviews_count').textContent = t.count_reviews;
      document.getElementById('t_qty').textContent = t.qty;
      document.getElementById('t_total').textContent = t.total;
      document.getElementById('t_fullname').textContent = t.fullname;
      document.getElementById('t_phone').textContent = t.phone;
      document.getElementById('t_address').textContent = t.address;
      document.getElementById('t_pay').textContent = t.pay;
      document.getElementById('t_note').textContent = t.note;
      document.getElementById('t_freeship').textContent = t.freeship;
      document.getElementById('t_freeship_sub').textContent = t.freeship_sub;
      document.getElementById('t_desc_title').textContent = t.desc_title;
      document.getElementById('t_desc_intro').textContent = t.desc_intro;
    }
    function switchLang(l){ lang = l; t = i18n[l]; localStorage.setItem('lang', l); document.documentElement.lang = (l==='th'?'th':'en'); setText(); updateBtns(); updateAll(); }
    function updateBtns(){ document.getElementById('langTH').classList.toggle('active', lang==='th'); document.getElementById('langEN').classList.toggle('active', lang==='en'); }

    // Totals/Summary + Limits (max 3)
    const UNIT_PRICE = 1299; // ‡∏¢‡πâ‡∏≥‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à
    const qtyEl = document.getElementById('quantity'), totalEl = document.getElementById('total');
    const sumItemsEl = document.getElementById('sumItems'), sumShipEl = document.getElementById('sumShip'), sumGrandEl = document.getElementById('sumGrand');
    function clampQty(v){ return Math.min(3, Math.max(1, v)); }
    function updateTotals(){
      const q = clampQty(parseInt(qtyEl.value||'1')); qtyEl.value = q;
      const items = q*UNIT_PRICE; totalEl.textContent = items; sumItemsEl.textContent = items; sumShipEl.textContent = t.free; sumGrandEl.textContent = items;
    }

    // Live stats
    let VIEWERS = Math.floor(Math.random()*10) + 18;
    let SALES_TODAY = Math.floor(Math.random()*8) + 12;
    function updateViewer(){ document.getElementById('viewerNow').textContent = t.viewing(VIEWERS); }
    function updateSales(){ document.getElementById('salesToday').textContent = SALES_TODAY; }
    const promoEndDate = (()=>{ const now=new Date(); return new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23,59,59); })();
    function updateCountdown(){ const now=new Date(); let d=Math.max(0,promoEndDate-now); const h=String(Math.floor(d/3600000)).padStart(2,'0'); d%=3600000; const m=String(Math.floor(d/60000)).padStart(2,'0'); d%=60000; const s=String(Math.floor(d/1000)).padStart(2,'0'); document.getElementById('countdown').textContent = `${h}:${m}:${s}`; }

    function updateStockBadge(){
      const el = document.getElementById('stockBadge');
      const cls = (ENFORCE_STOCK && INVENTORY <= 10) ? 'badge low' : 'badge in';
      el.className = cls;
      el.textContent = (ENFORCE_STOCK && INVENTORY <= 10) ? `${t.lowstock} (${INVENTORY})` : `${t.instock}${ENFORCE_STOCK?' ('+INVENTORY+')':''}`;
    }

    function updateAll(){ updateStockBadge(); updateViewer(); updateSales(); updateTotals(); }

    // Share
    function getShareUrl(){ return location.href.split('#')[0]; }
    function popup(u){ const w=560,h=640,l=(screen.width-w)/2,t=(screen.height-h)/2; window.open(u,'share',`width=${w},height=${h},left=${l},top=${t}`); }

    // QR + EmailJS
    function tlv(id,val){ const len=val.length; return id+String(len).padStart(2,'0')+val; }
    function crc16(str){ let crc=0xFFFF; for(let i=0;i<str.length;i++){ crc^=str.charCodeAt(i)<<8; for(let j=0;j<8;j++){ crc=(crc&0x8000)?((crc<<1)^0x1021):(crc<<1); crc&=0xFFFF; } } return crc.toString(16).toUpperCase().padStart(4,'0'); }
    function buildPromptPayPayload(acc, amount){
      const isNatId=/^\d{13}$/.test(acc), isPhone=/^0\d{9}$/.test(acc);
      let proxy=''; if(isPhone){ proxy='66'+acc.substring(1); } else if(isNatId){ proxy=acc; } else { throw new Error('Invalid PromptPay ID'); }
      const gui='A000000677010111', mai=tlv('00',gui)+tlv(isPhone?'01':'02',proxy), maiAll=tlv('29',mai);
      const payload=tlv('00','01')+tlv('01','11')+maiAll+tlv('52','0000')+tlv('53','764')+tlv('54',amount.toFixed(2))+tlv('58','TH')+tlv('59','-')+tlv('60','Bangkok')+'6304';
      return payload+crc16(payload);
    }

    function makeOrderId(){ const d=new Date(); const pad=n=>String(n).padStart(2,'0'); const ts=d.getFullYear().toString().slice(2)+pad(d.getMonth()+1)+pad(d.getDate())+pad(d.getHours())+pad(d.getMinutes())+pad(d.getSeconds()); const rnd=Math.random().toString(36).slice(-4).toUpperCase(); return `TP-${ts}-${rnd}`; }

    function init(){
      // Banners
      try{
        // ‡∏ñ‡πâ‡∏≤ DOMContentLoaded ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ‡πÅ‡∏õ‡∏•‡∏ß‡πà‡∏≤ inline script ‡∏ú‡πà‡∏≤‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏´‡∏ô‡∏∂‡πà‡∏á
        // ‡∏ó‡∏î‡∏™‡∏≠‡∏ö EmailJS/QRCode ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡πÑ‡∏´‡∏°
        if(!window.emailjs){ document.getElementById('bannerCSP').classList.remove('hide'); showDebug('EmailJS not loaded'); }
        if(!window.QRCode){ document.getElementById('bannerCSP').classList.remove('hide'); showDebug('QRCode library not loaded'); }
      }catch(e){ showDebug(e); }

      setText(); updateBtns(); updateAll(); updateCountdown();
      setInterval(()=>{ // jitter viewers/sales
        const d=Math.floor(Math.random()*5)-2; VIEWERS=Math.min(48,Math.max(8,VIEWERS+d));
        if(Math.random()<0.25){ SALES_TODAY+=1; updateSales(); }
        updateViewer();
      }, 6000);
      setInterval(updateCountdown, 1000);

      document.getElementById('langTH').onclick=()=>switchLang('th');
      document.getElementById('langEN').onclick=()=>switchLang('en');

      const mainImg=document.getElementById('mainImg');
      document.getElementById('thumbs').addEventListener('click',e=>{
        if(e.target.tagName.toLowerCase()==='img'){
          [...document.querySelectorAll('.thumbs img')].forEach(i=>i.classList.remove('active'));
          e.target.classList.add('active'); mainImg.src=e.target.src;
        }
      });

      document.getElementById('shareLine').onclick=()=>{
        const u=encodeURIComponent(getShareUrl()); const txt=encodeURIComponent("Pop Secret Popcorn 588g ‚Äî Movie Theater Butter");
        popup(`https://social-plugins.line.me/lineit/share?url=${u}%0A${txt}`);
      };
      document.getElementById('shareFb').onclick=()=>{
        const u=encodeURIComponent(getShareUrl()); popup(`https://www.facebook.com/sharer/sharer.php?u=${u}`);
      };

      const qtyEl=document.getElementById('quantity');
      qtyEl.addEventListener('input', updateTotals);
      qtyEl.addEventListener('change', updateTotals);

      document.getElementById('btnAddCart').onclick=()=>{
        let cur=parseInt(qtyEl.value||'1'); if(cur>=3){ alert(lang==='th'?'‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 3 ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ï‡πà‡∏≠‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠':'Maximum 3 boxes per order'); return; }
        qtyEl.value=Math.min(3,cur+1); updateTotals(); document.getElementById('orderForm').scrollIntoView({behavior:'smooth'});
      };
      document.getElementById('btnBuyNow').onclick=()=>{
        const f=document.getElementById('orderForm'); f.reportValidity(); if(f.checkValidity()){ submitOrder(); }
      };
      document.getElementById('orderForm').addEventListener('submit', e=>{ e.preventDefault(); submitOrder(); });
    }

    async function submitOrder(){
      try{
        const q=Math.min(3, Math.max(1, parseInt(document.getElementById('quantity').value||'1')));
        if(ENFORCE_STOCK && q>INVENTORY){ alert(lang==='th'?'‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠':'Quantity exceeds available stock'); return; }
        const name=document.getElementById('fname').value.trim();
        const phone=document.getElementById('phone').value.trim();
        const addr=document.getElementById('addr').value.trim();
        if(!name||!phone||!addr){ return; }

        const total=q*UNIT_PRICE;
        const account=(PROMPTPAY_USE==='nid')?PROMPTPAY_NATIONAL_ID:PROMPTPAY_MOBILE;
        const payload=buildPromptPayPayload(account,total);
        const box=document.getElementById('qrcode'); box.innerHTML='';
        if(!window.QRCode){ showDebug('QRCode not ready'); throw new Error('QRCode not loaded'); }
        await new Promise((resolve,reject)=>{ QRCode.toCanvas(document.createElement('canvas'), payload, (err,canvas)=>{ if(err){reject(err);return;} box.appendChild(canvas); resolve(); }); });

        // EmailJS
        if(!window.emailjs){ showDebug('EmailJS not ready'); throw new Error('EmailJS not loaded'); }
        emailjs.init({ publicKey: EMAILJS_PUBLIC_KEY });
        const order_id=makeOrderId(), order_datetime=new Date().toLocaleString();
        const mailVars={
          to_email: EMAIL_TO, name, phone, address: addr, lang,
          order_id, order_datetime, product_name: PRODUCT_NAME,
          quantity:q, unit_price:UNIT_PRICE, items:(q*UNIT_PRICE),
          shipping:0, grand_total:(q*UNIT_PRICE), freeship:true
        };
        showDebug({sending_email_with: mailVars});
        await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, mailVars);

        if(ENFORCE_STOCK){ INVENTORY-=q; } SALES_TODAY+=q; updateStockBadge(); updateSales();
        document.getElementById('msg').textContent = t.ok; document.getElementById('msg').style.display='block';
        document.getElementById('err').style.display='none';
      }catch(e){
        document.getElementById('err').textContent = t.err + " | " + e.message;
        document.getElementById('err').style.display='block';
        document.getElementById('msg').style.display='none';
        showDebug(e);
        document.getElementById('bannerCSP').classList.remove('hide');
      }
    }

    // Bootstrap
    document.addEventListener('DOMContentLoaded', init);
  </script>

  <!-- ===== HOW TO FIX CSP on Netlify (‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏±‡πâ‡∏ô ‡πÜ) =====
  1) ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∏‡∏ì Deploy ‡∏î‡πâ‡∏ß‡∏¢‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß):
     - ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå _headers ‡∏ß‡∏≤‡∏á‡∏Ç‡πâ‡∏≤‡∏á index.html ‡πÉ‡∏™‡πà:
       /*
         Content-Security-Policy: default-src 'self' https:;
           img-src * data:;
           script-src 'self' https://cdn.jsdelivr.net 'unsafe-inline';
           style-src 'self' 'unsafe-inline';
           connect-src *;

  2) ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ netlify.toml:
     [[headers]]
       for = "/*"
       [headers.values]
       Content-Security-Policy = "default-src 'self' https:; img-src * data:; script-src 'self' https://cdn.jsdelivr.net 'unsafe-inline'; style-src 'self' 'unsafe-inline'; connect-src *;"

  3) ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡∏≠‡∏¢‡∏≤‡∏Å "‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß" ‡∏à‡∏£‡∏¥‡∏á ‡πÜ: ‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï 'unsafe-inline' ‡πÉ‡∏ô script-src
     (‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏≠‡∏¢‡∏π‡πà‡∏†‡∏≤‡∏¢‡πÉ‡∏ô <script> ‡∏Ç‡∏≠‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)
  -->
</body>
</html>
